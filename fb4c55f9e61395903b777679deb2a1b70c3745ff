{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "df54e486_d610db70",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheFactory.java",
        "patchSetId": 19
      },
      "lineNbr": 88,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "executor seems a bit generic.\nThis `executor` is used by the loader to populate the store\nShall we highlight in the name what this is for?\n\nloaderExecutor?\nstoreLoaderExecutor?",
      "range": {
        "startLine": 88,
        "startChar": 9,
        "endLine": 88,
        "endChar": 17
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f62d5d49_e0d4d735",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheFactory.java",
        "patchSetId": 19
      },
      "lineNbr": 88,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "df54e486_d610db70",
      "range": {
        "startLine": 88,
        "startChar": 9,
        "endLine": 88,
        "endChar": 17
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "136eeb15_9a894c22",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "Is this really @Nullable?\nIt looks to me we always pass an instance of GuavaInMemoryCache to the ChronicleMapCacheImpl constructor",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 78,
        "endChar": 40
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7b2a6c6_ccd50e73",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "136eeb15_9a894c22",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 78,
        "endChar": 40
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1a249ee_176005f0",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 79,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "This also should is never null.",
      "range": {
        "startLine": 79,
        "startChar": 6,
        "endLine": 79,
        "endChar": 15
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c959df1_0867fecd",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 88,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "I believe mem is always defined, isn\u0027t?",
      "range": {
        "startLine": 88,
        "startChar": 0,
        "endLine": 88,
        "endChar": 69
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bd2076cd_cbad230a",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 88,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3c959df1_0867fecd",
      "range": {
        "startLine": 88,
        "startChar": 0,
        "endLine": 88,
        "endChar": 69
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c6038c4_fcd7b080",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 96,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: Perhaps we should call this createOrRecoverStore to highlight the fact that this is not just creating a new store every time is called.",
      "range": {
        "startLine": 96,
        "startChar": 59,
        "endLine": 96,
        "endChar": 70
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "12f8d8f5_61eb96d9",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 96,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0c6038c4_fcd7b080",
      "range": {
        "startLine": 96,
        "startChar": 59,
        "endLine": 96,
        "endChar": 70
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d46243a2_996cb899",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 128,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: unrelated?",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 128,
        "endChar": 73
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eb2063cb_1f737ff9",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 128,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Partly related, because this is now part of a static method and cannot refer to the \u0027store\u0027 instance variable.",
      "parentUuid": "d46243a2_996cb899",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 128,
        "endChar": 73
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ea96d7f9_0ea16119",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 269,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "I am still getting my head around this:\nShouldn\u0027t values from the ChronicleMap store exclusively loaded by the CacheChronicleMapLoader?",
      "range": {
        "startLine": 269,
        "startChar": 0,
        "endLine": 269,
        "endChar": 82
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e8b259ed_032075f6",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheImpl.java",
        "patchSetId": 19
      },
      "lineNbr": 269,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "True, I\u0027ve removed it and use memLoader instead.",
      "parentUuid": "ea96d7f9_0ea16119",
      "range": {
        "startLine": 269,
        "startChar": 0,
        "endLine": 269,
        "endChar": 82
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f14e81bb_28b24794",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 119,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: might be useful to log which cache and which key caused the failure as they might not be obvious from the stack trace.",
      "range": {
        "startLine": 119,
        "startChar": 12,
        "endLine": 119,
        "endChar": 80
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9fa7f338_f816cf41",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 119,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f14e81bb_28b24794",
      "range": {
        "startLine": 119,
        "startChar": 12,
        "endLine": 119,
        "endChar": 80
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86cf9c69_efc6ef43",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 131,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: this logic is the same of the one implemented by ChronicleMapCacheImpl, consider DRY this out.\n\n```\n  static boolean expired(Duration expireAfterWrite, long created) {\n    Duration age \u003d Duration.between(Instant.ofEpochMilli(created), TimeUtil.now());\n    return !expireAfterWrite.isZero() \u0026\u0026 age.compareTo(expireAfterWrite) \u003e 0;\n  }\n```",
      "range": {
        "startLine": 128,
        "startChar": 0,
        "endLine": 131,
        "endChar": 3
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "838a347b_c61dd60c",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 131,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86cf9c69_efc6ef43",
      "range": {
        "startLine": 128,
        "startChar": 0,
        "endLine": 131,
        "endChar": 3
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fc5711d_171d2d47",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 147,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "these getters appear unused",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 147,
        "endChar": 3
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ab8ab263_b897a2c1",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheLoader.java",
        "patchSetId": 19
      },
      "lineNbr": 147,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Removed.",
      "parentUuid": "1fc5711d_171d2d47",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 147,
        "endChar": 3
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f66626fe_a50a4864",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 25,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: can be final",
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9d0f9d3_1ddad158",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 25,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f66626fe_a50a4864",
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "675071e3_e4e5dde1",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 28,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "Do we need this parameter?\nCan\u0027t we just look at the time of `guavaCache` to understand whether this is LoadingCache\u003c\u003e?",
      "range": {
        "startLine": 28,
        "startChar": 62,
        "endLine": 28,
        "endChar": 84
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f45c16de_cf35f2e2",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 28,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Unfortunately not: the guavaCache we receive is *always* a loading one because it needs to load from ChronicleMap store, but it may or may not be linked to an external loading source.\n\nHence it could be an instance of a loading cache but effectively NOT loading from an external source.",
      "parentUuid": "675071e3_e4e5dde1",
      "range": {
        "startLine": 28,
        "startChar": 62,
        "endLine": 28,
        "endChar": 84
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9feffb78_bb655112",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 28,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T19:04:04Z",
      "side": 1,
      "message": "\u003e Unfortunately not: the guavaCache we receive is *always* a loading one\n\nShall we change the signature of the constructor to be more specific then?\n\n```\nGuavaInMemoryCache(LoadingCache\u003cK, TimedValue\u003cV\u003e\u003e guavaCache, boolean loadingCache)\n```\n\n\n\u003e because it needs to load from ChronicleMap store, but it may or may not be linked to an external loading source.\n\u003e \n\u003e Hence it could be an instance of a loading cache but effectively NOT loading from an external source.\n\nGotcha.\n\nperhaps the `loadingCache` name is a bit confusing here, since it overlaps with the fact that guava is already a LoadingCache?\n\nHow about: `hasExternalLoader` or something similar.\n\nAlso, could you consider adding just a couple of lines of comment to explain why we have this:\n\n- Why the ChronicleMapCacheLoader takes a `loader` as parameter.\n- Why the GuavaInMemoryCache takes a LoadingCache *and* a boolean indicating whether to load from an external source.",
      "parentUuid": "f45c16de_cf35f2e2",
      "range": {
        "startLine": 28,
        "startChar": 62,
        "endLine": 28,
        "endChar": 84
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b944a97_bff73728",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 55,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: shoud use isLoadingCache()",
      "range": {
        "startLine": 55,
        "startChar": 8,
        "endLine": 55,
        "endChar": 20
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "181829fc_88a4c64c",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 55,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Why? LoadingCache is a private boolean and is accessible to internal methods. Is there any value in making yet another method call?",
      "parentUuid": "1b944a97_bff73728",
      "range": {
        "startLine": 55,
        "startChar": 8,
        "endLine": 55,
        "endChar": 20
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "843e94f5_3b57881b",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/GuavaInMemoryCache.java",
        "patchSetId": 19
      },
      "lineNbr": 55,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T19:04:04Z",
      "side": 1,
      "message": "the refresh() method at L70 is using the isLoadingCache() method, so it was just for consistency.\n\nWe can adapt either of those.\n\njust a nit anyway.",
      "parentUuid": "181829fc_88a4c64c",
      "range": {
        "startLine": 55,
        "startChar": 8,
        "endLine": 55,
        "endChar": 20
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cccd2082_49320385",
        "filename": "src/test/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheIT.java",
        "patchSetId": 19
      },
      "lineNbr": 60,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-09-30T12:52:37Z",
      "side": 1,
      "message": "nit: consider naming this `memoryLimit`",
      "range": {
        "startLine": 60,
        "startChar": 74,
        "endLine": 60,
        "endChar": 76
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74c333f8_50aba972",
        "filename": "src/test/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheIT.java",
        "patchSetId": 19
      },
      "lineNbr": 60,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-09-30T18:09:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cccd2082_49320385",
      "range": {
        "startLine": 60,
        "startChar": 74,
        "endLine": 60,
        "endChar": 76
      },
      "revId": "fb4c55f9e61395903b777679deb2a1b70c3745ff",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}