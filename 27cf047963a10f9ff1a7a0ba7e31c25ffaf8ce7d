{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f82f3db2_f2ea84f5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T00:53:18Z",
      "side": 1,
      "message": "Verified with Gerrit v3.3.x E2E",
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ed63221_34aff937",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 38,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "Is changing this signature related to this CR?\nis it just so that you can map over the result? [1]\n\nAlso, the isEmpty method and constructors are now unused and should be removed[2]\n\n[1] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java#200\n\n[2] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2AggregateData.java#33",
      "range": {
        "startLine": 38,
        "startChar": 19,
        "endLine": 38,
        "endChar": 66
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1fe3fb0c_5b2d504c",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 38,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "\u003e Is changing this signature related to this CR?\n\nYou mean related to this Change? Yes, it is.\n\n\u003e is it just so that you can map over the result? [1]\n\nThe ChronicleMap becomes an Optional\u003c\u003e in this change and therefore may or may not exist, either from the config or the H2 cache.\n\n\u003e Also, the isEmpty method and constructors are now unused and should be removed[2]\n\u003e \n\u003e [1] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java#200\n\u003e \n\u003e [2] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2AggregateData.java#33\n\nDone.",
      "parentUuid": "2ed63221_34aff937",
      "range": {
        "startLine": 38,
        "startChar": 19,
        "endLine": 38,
        "endChar": 66
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e094175_503592ec",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 38,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-21T10:22:44Z",
      "side": 1,
      "message": "\u003e \u003e Is changing this signature related to this CR?\n\u003e \n\u003e You mean related to this Change? Yes, it is.\n\u003e \n\u003e \u003e is it just so that you can map over the result? [1]\n\u003e \n\u003e The ChronicleMap becomes an Optional\u003c\u003e in this change and therefore may or may not exist, either from the config or the H2 cache.\n\nI am still trying to understand the need for this change:\n\nBefore, the lack of h2 cache information was modelled by using the H2AggregateData.isEmpty() method.\nWhat\u0027s the rationale of moving this one layer up to the Optional.isEmpty() instead?\n\nAnyway, not a big deal ðŸ˜Š\n\n\u003e \n\u003e \u003e Also, the isEmpty method and constructors are now unused and should be removed[2]\n\u003e \u003e \n\u003e \u003e [1] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java#200\n\u003e \u003e \n\u003e \u003e [2] https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/changes/62/312562/3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2AggregateData.java#33\n\u003e \n\u003e Done.",
      "parentUuid": "1fe3fb0c_5b2d504c",
      "range": {
        "startLine": 38,
        "startChar": 19,
        "endLine": 38,
        "endChar": 66
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba858bf0_01f69278",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 38,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-07-21T18:50:18Z",
      "side": 1,
      "message": "No sure either about this signature change ðŸ˜•",
      "parentUuid": "1e094175_503592ec",
      "range": {
        "startLine": 38,
        "startChar": 19,
        "endLine": 38,
        "endChar": 66
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32451b56_6a46a58d",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 61,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-07-20T09:49:26Z",
      "side": 1,
      "message": "Is this part of this change? If yes can we add a comment in why we are checking for \"size \u003e 0\" ? Why shouldn\u0027t we have entries in H2 while migrating ?",
      "range": {
        "startLine": 55,
        "startChar": 9,
        "endLine": 61,
        "endChar": 32
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2f97da19_59e06c55",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2CacheCommand.java",
        "patchSetId": 3
      },
      "lineNbr": 61,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "I can add a comment on that: a cache may be defined but empty and therefore we may not know nothing about it.",
      "parentUuid": "32451b56_6a46a58d",
      "range": {
        "startLine": 55,
        "startChar": 9,
        "endLine": 61,
        "endChar": 32
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31a294ef_4e57cf7e",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "These parameters are effectively ignored when a previous configuration exists.\n\nI think we should at least give a warning to the user that this is the case and document this behaviour in the documentation.\n\nI am thinking whether an alternative approach would be to be _explicit_ when calling the REST-API as to whether the previous configuration should be used or new averages computed.\n\nsomething like:\n\n```\n\u0026use-current-config\u003dtrue\n```\n\nWDYT?",
      "range": {
        "startLine": 156,
        "startChar": 0,
        "endLine": 164,
        "endChar": 45
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a3b59c3_9fec00b8",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "\u003e These parameters are effectively ignored when a previous configuration exists.\n\u003e \n\u003e I think we should at least give a warning to the user that this is the case and document this behaviour in the documentation.\n\nI\u0027ll document the behaviour. We can\u0027t give a warning because the output is already used to return the new configuration.\n\n\u003e I am thinking whether an alternative approach would be to be _explicit_ when calling the REST-API as to whether the previous configuration should be used or new averages computed.\n\nThat doesn\u0027t resolve the issue: you can have the maxBloatFactor be used for cacheA but not for cacheB (because of existing settings).\n\n\u003e something like:\n\u003e \n\u003e ```\n\u003e \u0026use-current-config\u003dtrue\n\nSure, we could, but won\u0027t resolve the issue of warning the user when the parameter is used or not.",
      "parentUuid": "31a294ef_4e57cf7e",
      "range": {
        "startLine": 156,
        "startChar": 0,
        "endLine": 164,
        "endChar": 45
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da282a37_1f261c31",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 183,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "nit: redundant initialization",
      "range": {
        "startLine": 183,
        "startChar": 60,
        "endLine": 183,
        "endChar": 80
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9a36377f_c7193786",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 183,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "da282a37_1f261c31",
      "range": {
        "startLine": 183,
        "startChar": 60,
        "endLine": 183,
        "endChar": 80
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60a3ebcb_f1ce53fc",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 189,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-07-20T09:49:26Z",
      "side": 1,
      "message": "What if we wrap this into a method like:\n  boolean isMaunalTuning() {...}\n  \nThis is what the check is for, right?",
      "range": {
        "startLine": 186,
        "startChar": 14,
        "endLine": 189,
        "endChar": 81
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fca15c5c_bcfbfc8f",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 189,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "All these settings have a default value.\nWhat if an existing configuration has only avgKeySize and avgValueSize explicitly set, whilst  maxEntries is not defined?\n\nI think if *any* of these is set (as opposed to *all*), then we should consider it pre-configured, and missing values should be taken from the defaults, where missing.",
      "range": {
        "startLine": 186,
        "startChar": 10,
        "endLine": 189,
        "endChar": 84
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "81cc5f09_4153af2a",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 189,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "\u003e All these settings have a default value.\n\u003e What if an existing configuration has only avgKeySize and avgValueSize explicitly set, whilst  maxEntries is not defined?\n\nI don\u0027t believe that\u0027s a valid configuration and therefore we won\u0027t be able to use it.\n\n\u003e I think if *any* of these is set (as opposed to *all*), then we should consider it pre-configured, and missing values should be taken from the defaults, where missing.\n\nI disagree: if you don\u0027t define all of them it means you did make a mistake when copy \u0026 pasting from an existing pre-testing in staging of the H2 cache files.\n\nIgnoring them is the right thing to do IMHO, but we should add a warning to the logs. Adding that now.",
      "parentUuid": "fca15c5c_bcfbfc8f",
      "range": {
        "startLine": 186,
        "startChar": 10,
        "endLine": 189,
        "endChar": 84
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6587b337_1ac41493",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 189,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "60a3ebcb_f1ce53fc",
      "range": {
        "startLine": 186,
        "startChar": 14,
        "endLine": 189,
        "endChar": 81
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab231d56_c73babd6",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 189,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-21T10:22:44Z",
      "side": 1,
      "message": "\u003e \u003e All these settings have a default value.\n\u003e \u003e What if an existing configuration has only avgKeySize and avgValueSize explicitly set, whilst  maxEntries is not defined?\n\u003e \n\u003e I don\u0027t believe that\u0027s a valid configuration and therefore we won\u0027t be able to use it.\n\nWhy do you believe that\u0027s not a valid configuration?\n\nConsider, for example:\n\n[cache \"foo\"]\n avgKeySize \u003d 1024\n avgValueSize \u003d 2048\n \nThis is a valid configuration.\nThe cache is configured by using those settings and falls back do defaults[1] for other (i.e. maxEntries, maxBlotFactor, etc).\nThere are no warnings, nor errors related to this cache.\n \n\u003e \n\u003e \u003e I think if *any* of these is set (as opposed to *all*), then we should consider it pre-configured, and missing values should be taken from the defaults, where missing.\n\u003e \n\u003e I disagree: if you don\u0027t define all of them it means you did make a mistake when copy \u0026 pasting from an existing pre-testing in staging of the H2 cache files.\n\u003e \n\u003e Ignoring them is the right thing to do IMHO, but we should add a warning to the logs. Adding that now.\n\n\n[1]https://gerrit.googlesource.com/modules/cache-chroniclemap/+/refs/heads/stable-3.3/src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/ChronicleMapCacheConfig.java#171",
      "parentUuid": "81cc5f09_4153af2a",
      "range": {
        "startLine": 186,
        "startChar": 10,
        "endLine": 189,
        "endChar": 84
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "412488d5_bb94be96",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 201,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "nit: stats?",
      "range": {
        "startLine": 201,
        "startChar": 24,
        "endLine": 201,
        "endChar": 30
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b13b592_c5c60d61",
        "filename": "src/main/java/com/googlesource/gerrit/modules/cache/chroniclemap/H2MigrationServlet.java",
        "patchSetId": 3
      },
      "lineNbr": 201,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "412488d5_bb94be96",
      "range": {
        "startLine": 201,
        "startChar": 24,
        "endLine": 201,
        "endChar": 30
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d97dc80c_3dc459d3",
        "filename": "src/test/java/com/googlesource/gerrit/modules/cache/chroniclemap/MigrateH2CachesLocalDiskIT.java",
        "patchSetId": 3
      },
      "lineNbr": 179,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-07-20T12:52:41Z",
      "side": 1,
      "message": "I think it would be worth testing this behavior when only a subset of config exists",
      "range": {
        "startLine": 176,
        "startChar": 0,
        "endLine": 179,
        "endChar": 69
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e876ec38_e46071fc",
        "filename": "src/test/java/com/googlesource/gerrit/modules/cache/chroniclemap/MigrateH2CachesLocalDiskIT.java",
        "patchSetId": 3
      },
      "lineNbr": 179,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-07-20T22:12:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d97dc80c_3dc459d3",
      "range": {
        "startLine": 176,
        "startChar": 0,
        "endLine": 179,
        "endChar": 69
      },
      "revId": "27cf047963a10f9ff1a7a0ba7e31c25ffaf8ce7d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}